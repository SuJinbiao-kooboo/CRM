<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.crm.supplier.mapper.CrmSupplierMapper">
    
    <sql id="selectCrmSupplierVo">
        select id, supplier_code, supplier_name, supplier_short_name, country, supplier_type, website, main_products, cooperation_level, credit_rating, payment_terms, business_license, tax_number, bank_name, bank_account, address, introduction, status, create_by, create_time, update_by, update_time, remark, tags from crm_supplier
    </sql>
    
    <sql id="selectSupplierWithContactVo">
        select 
            s.id, s.supplier_code, s.supplier_name, s.supplier_short_name, s.country, s.supplier_type, 
            s.website, s.main_products, s.cooperation_level, s.credit_rating, s.payment_terms, 
            s.business_license, s.tax_number, s.bank_name, s.bank_account, s.address, s.introduction, 
            s.status, s.create_by, s.create_time, s.update_by, s.update_time, s.remark, s.tags,
            c.contact_name, c.phone, c.email, c.position, c.whatsapp, c.wechat, c.qq, c.other_contact
        from crm_supplier s
        left join crm_supplier_contact c on s.id = c.supplier_id
    </sql>

    <select id="selectCrmSupplierList" parameterType="CrmSupplier" resultType="CrmSupplier">
        <include refid="selectCrmSupplierVo"/>
        <where>  
            <if test="supplierCode != null  and supplierCode != ''"> and supplier_code like concat('%', #{supplierCode}, '%')</if>
            <if test="supplierName != null  and supplierName != ''"> and supplier_name like concat('%', #{supplierName}, '%')</if>
            <if test="country != null  and country != ''"> and country = #{country}</if>
            <if test="supplierType != null  and supplierType != ''"> and supplier_type = #{supplierType}</if>
            <if test="status != null"> and status = #{status}</if>
            <if test="cooperationLevel != null  and cooperationLevel != ''"> and cooperation_level = #{cooperationLevel}</if>
        </where>
        order by create_time desc
    </select>
    
    <select id="selectSupplierListWithContact" parameterType="SupplierVO" resultType="SupplierVO">
        <include refid="selectSupplierWithContactVo"/>
        <where>  
            <if test="supplierCode != null  and supplierCode != ''"> and s.supplier_code like concat('%', #{supplierCode}, '%')</if>
            <if test="supplierName != null  and supplierName != ''"> and s.supplier_name like concat('%', #{supplierName}, '%')</if>
            <if test="country != null  and country != ''"> and s.country = #{country}</if>
            <if test="supplierType != null  and supplierType != ''"> and s.supplier_type = #{supplierType}</if>
            <if test="status != null"> and s.status = #{status}</if>
            <if test="cooperationLevel != null  and cooperationLevel != ''"> and s.cooperation_level = #{cooperationLevel}</if>
            <if test="contactName != null  and contactName != ''"> and c.contact_name like concat('%', #{contactName}, '%')</if>
        </where>
        order by s.create_time desc
    </select>
    
    <select id="selectCrmSupplierById" parameterType="Long" resultType="CrmSupplier">
        <include refid="selectCrmSupplierVo"/>
        where id = #{id}
    </select>
        
    <insert id="insertCrmSupplier" parameterType="CrmSupplier" useGeneratedKeys="true" keyProperty="id">
        insert into crm_supplier
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="supplierCode != null">supplier_code,</if>
            <if test="supplierName != null">supplier_name,</if>
            <if test="supplierShortName != null">supplier_short_name,</if>
            <if test="country != null">country,</if>
            <if test="supplierType != null">supplier_type,</if>
            <if test="website != null">website,</if>
            <if test="mainProducts != null">main_products,</if>
            <if test="cooperationLevel != null">cooperation_level,</if>
            <if test="creditRating != null">credit_rating,</if>
            <if test="paymentTerms != null">payment_terms,</if>
            <if test="businessLicense != null">business_license,</if>
            <if test="taxNumber != null">tax_number,</if>
            <if test="bankName != null">bank_name,</if>
            <if test="bankAccount != null">bank_account,</if>
            <if test="address != null">address,</if>
            <if test="introduction != null">introduction,</if>
            <if test="status != null">status,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="supplierCode != null">#{supplierCode},</if>
            <if test="supplierName != null">#{supplierName},</if>
            <if test="supplierShortName != null">#{supplierShortName},</if>
            <if test="country != null">#{country},</if>
            <if test="supplierType != null">#{supplierType},</if>
            <if test="website != null">#{website},</if>
            <if test="mainProducts != null">#{mainProducts},</if>
            <if test="cooperationLevel != null">#{cooperationLevel},</if>
            <if test="creditRating != null">#{creditRating},</if>
            <if test="paymentTerms != null">#{paymentTerms},</if>
            <if test="businessLicense != null">#{businessLicense},</if>
            <if test="taxNumber != null">#{taxNumber},</if>
            <if test="bankName != null">#{bankName},</if>
            <if test="bankAccount != null">#{bankAccount},</if>
            <if test="address != null">#{address},</if>
            <if test="introduction != null">#{introduction},</if>
            <if test="status != null">#{status},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
         </trim>
    </insert>

    <update id="updateCrmSupplier" parameterType="CrmSupplier">
        update crm_supplier
        <trim prefix="SET" suffixOverrides=",">
            <if test="supplierCode != null">supplier_code = #{supplierCode},</if>
            <if test="supplierName != null">supplier_name = #{supplierName},</if>
            <if test="supplierShortName != null">supplier_short_name = #{supplierShortName},</if>
            <if test="country != null">country = #{country},</if>
            <if test="supplierType != null">supplier_type = #{supplierType},</if>
            <if test="website != null">website = #{website},</if>
            <if test="mainProducts != null">main_products = #{mainProducts},</if>
            <if test="cooperationLevel != null">cooperation_level = #{cooperationLevel},</if>
            <if test="creditRating != null">credit_rating = #{creditRating},</if>
            <if test="paymentTerms != null">payment_terms = #{paymentTerms},</if>
            <if test="businessLicense != null">business_license = #{businessLicense},</if>
            <if test="taxNumber != null">tax_number = #{taxNumber},</if>
            <if test="bankName != null">bank_name = #{bankName},</if>
            <if test="bankAccount != null">bank_account = #{bankAccount},</if>
            <if test="address != null">address = #{address},</if>
            <if test="introduction != null">introduction = #{introduction},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCrmSupplierById" parameterType="Long">
        delete from crm_supplier where id = #{id}
    </delete>

    <delete id="deleteCrmSupplierByIds" parameterType="String">
        delete from crm_supplier where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>