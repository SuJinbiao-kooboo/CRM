<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.crm.inquiry.mapper.CrmInquiryMapper">
    
    <sql id="selectCrmInquiryVo">
        select id, inquiry_code, customer_id, inquiry_date, valid_until, inquirer_contact_id, follow_by, inquiry_status, urgency_level, create_by, create_time, update_by, update_time, remark from crm_inquiry
    </sql>

    <select id="selectCrmInquiryList" parameterType="CrmInquiry" resultType="CrmInquiry">
        <include refid="selectCrmInquiryVo"/>
        <where>  
            <if test="inquiryCode != null  and inquiryCode != ''"> and inquiry_code like concat('%', #{inquiryCode}, '%')</if>
            <if test="customerId != null "> and customer_id = #{customerId}</if>
            <if test="inquiryDate != null "> and inquiry_date = #{inquiryDate}</if>
            <if test="validUntil != null "> and valid_until = #{validUntil}</if>
            <if test="inquirerContactId != null "> and inquirer_contact_id = #{inquirerContactId}</if>
            <if test="followBy != null "> and follow_by = #{followBy}</if>
            <if test="inquiryStatus != null  and inquiryStatus != ''"> and inquiry_status = #{inquiryStatus}</if>
            <if test="urgencyLevel != null  and urgencyLevel != ''"> and urgency_level = #{urgencyLevel}</if>
        </where>
        order by create_time desc
    </select>
    
    <select id="selectCrmInquiryById" parameterType="Long" resultType="CrmInquiry">
        <include refid="selectCrmInquiryVo"/>
        where id = #{id}
    </select>
        
    <insert id="insertCrmInquiry" parameterType="CrmInquiry" useGeneratedKeys="true" keyProperty="id">
        insert into crm_inquiry
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="inquiryCode != null">inquiry_code,</if>
            <if test="customerId != null">customer_id,</if>
            <if test="inquiryDate != null">inquiry_date,</if>
            <if test="validUntil != null">valid_until,</if>
            <if test="inquirerContactId != null">inquirer_contact_id,</if>
            <if test="followBy != null">follow_by,</if>
            <if test="inquiryStatus != null">inquiry_status,</if>
            <if test="urgencyLevel != null">urgency_level,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="inquiryCode != null">#{inquiryCode},</if>
            <if test="customerId != null">#{customerId},</if>
            <if test="inquiryDate != null">#{inquiryDate},</if>
            <if test="validUntil != null">#{validUntil},</if>
            <if test="inquirerContactId != null">#{inquirerContactId},</if>
            <if test="followBy != null">#{followBy},</if>
            <if test="inquiryStatus != null">#{inquiryStatus},</if>
            <if test="urgencyLevel != null">#{urgencyLevel},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
         </trim>
    </insert>

    <update id="updateCrmInquiry" parameterType="CrmInquiry">
        update crm_inquiry
        <trim prefix="SET" suffixOverrides=",">
            <if test="inquiryCode != null">inquiry_code = #{inquiryCode},</if>
            <if test="customerId != null">customer_id = #{customerId},</if>
            <if test="inquiryDate != null">inquiry_date = #{inquiryDate},</if>
            <if test="validUntil != null">valid_until = #{validUntil},</if>
            <if test="inquirerContactId != null">inquirer_contact_id = #{inquirerContactId},</if>
            <if test="followBy != null">follow_by = #{followBy},</if>
            <if test="inquiryStatus != null">inquiry_status = #{inquiryStatus},</if>
            <if test="urgencyLevel != null">urgency_level = #{urgencyLevel},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteCrmInquiryById" parameterType="Long">
        delete from crm_inquiry where id = #{id}
    </delete>

    <delete id="deleteCrmInquiryByIds" parameterType="String">
        delete from crm_inquiry where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>